import puppeteer from 'puppeteer';
import chromium from '@sparticuz/chromium';

export interface EstimateItem {
  id: string;
  description: string;
  quantity: number;
  unit: string;
  unit_price: number;
  line_total: number;
  arbetsmoment: string;
}

export interface LeadData {
  first_name: string;
  last_name: string;
  phone: string;
  email: string;
  full_address: string;
  street_address: string;
  postal_code: string;
  city: string;
}

export interface EstimateData {
  id: string;
  estimate_nr: number;
  status: string;
  created: string;
  valid_until: string;
  notes: string;
  total_amount: number;
  total_amount_vat: number;
  vat_amount: number;
  estimated_work_days: number;
  items: EstimateItem[];
  lead: LeadData | null;
}

/**
 * Generate HTML content for PDF from estimate data
 */
function generateHTMLContent(estimate: EstimateData): string {
  const formatCurrency = (amount: number) => {
    return new Intl.NumberFormat('sv-SE', {
      style: 'currency',
      currency: 'SEK',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0,
    }).format(amount);
  };

  const formatDate = (dateString: string) => {
    return new Date(dateString).toLocaleDateString('sv-SE');
  };

  // Function to clean category names by removing sort numbers
  const cleanCategoryName = (category: string): string => {
    // Remove pattern like "10 - ", "20 - ", "99 - " etc.
    return category.replace(/^\d+\s*-\s*/, '');
  };

  // Group items by arbetsmoment (work category)
  const groupedItems = estimate.items.reduce((groups, item) => {
    const category = cleanCategoryName(item.arbetsmoment || 'Ã–vriga arbeten');
    if (!groups[category]) {
      groups[category] = [];
    }
    groups[category].push(item);
    return groups;
  }, {} as Record<string, EstimateItem[]>);

  // Calculate totals by category
  const categoryTotals = Object.entries(groupedItems).map(([category, items]) => ({
    category,
    total: items.reduce((sum, item) => sum + item.line_total, 0),
    items
  }));

  const clientName = estimate.lead 
    ? `${estimate.lead.first_name} ${estimate.lead.last_name}`
    : 'Kund';

  const clientAddress = estimate.lead?.full_address || 'Adress';
  const clientPhone = estimate.lead?.phone || 'Telefon';
  const clientEmail = estimate.lead?.email || 'E-post';

  // Generate estimate table HTML
  const estimateTableHTML = categoryTotals.map(({ category, items, total }) => `
    <tr class="category-header">
      <td colspan="5">${category}</td>
    </tr>
    ${items.map(item => `
      <tr>
        <td>${item.description}</td>
        <td class="text-right">${item.quantity}</td>
        <td>${item.unit}</td>
        <td class="text-right">${formatCurrency(item.unit_price)}</td>
        <td class="text-right">${formatCurrency(item.line_total)}</td>
      </tr>
    `).join('')}
    <tr class="category-total">
      <td colspan="4"><strong>Summa ${category}</strong></td>
      <td class="text-right"><strong>${formatCurrency(total)}</strong></td>
    </tr>
  `).join('');

  return `
    <!DOCTYPE html>
    <html>
      <head>
        <meta charset="utf-8" />
        <title>BKS AB - Offert #${estimate.estimate_nr}</title>
        <style>
          * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
          }
          
          body {
            font-family: Arial, sans-serif;
            font-size: 14px;
            line-height: 1.6;
            color: #333;
            max-width: 210mm;
            margin: 0 auto;
            padding: 20px;
            background: white;
          }
          
          .header-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
          }
          
          .header-table td {
            padding: 15px;
            border: 1px solid #ddd;
            vertical-align: top;
          }
          
          .header-table td:first-child {
            width: 50%;
          }
          
          h1 {
            color: #2c5530;
            font-size: 24px;
            margin-bottom: 20px;
            text-align: center;
          }
          
          h2 {
            color: #2c5530;
            font-size: 18px;
            margin: 25px 0 15px 0;
            border-bottom: 2px solid #2c5530;
            padding-bottom: 5px;
          }
          
          h3 {
            color: #2c5530;
            font-size: 16px;
            margin: 20px 0 10px 0;
          }
          
          .estimate-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
          }
          
          .estimate-table th,
          .estimate-table td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: left;
          }
          
          .estimate-table th {
            background-color: #f5f5f5;
            font-weight: bold;
          }
          
          .category-header {
            background-color: transparent;
            color: #333;
            font-weight: bold;
            font-size: 16px;
          }
          
          .category-total {
            background-color: #e5e5e5;
            font-weight: bold;
          }
          
          .final-totals {
            background-color: #e8f5e8;
            font-weight: bold;
          }
          
          .text-right {
            text-align: right;
          }
          
          .greeting {
            margin: 20px 0;
            font-size: 16px;
          }
          
          p {
            margin-bottom: 15px;
            text-align: justify;
          }
          
          ul, ol {
            margin: 15px 0;
            padding-left: 25px;
          }
          
          li {
            margin-bottom: 8px;
          }
          
          .contact-info {
            margin-top: 40px;
            padding: 20px;
            background-color: #f9f9f9;
            border-left: 4px solid #2c5530;
          }
          
          .page-break {
            page-break-before: always;
          }
          
          .signature-section {
            margin-top: 50px;
            text-align: center;
          }
          
          .logo-container {
            text-align: center;
            margin-bottom: 20px;
          }
          
          .logo {
            max-width: 120px;
            height: auto;
          }
        </style>
      </head>
      <body>
        <div class="logo-container">
          <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAACICAYAAACtWK6eAAAAAXNSR0IArs4c6QAAIABJREFUeF7tXQd4VEXXPpOzSQgJNSE0QYpKE0GwIkUQRUSwIYgNASmKKNbfCkIQFREFCwgWQGxY+BRQQVERC4iAFOktCSVAQiBl27z/e2Z3N5ts3yQBgsl93+fdt5l75507c+ac22Ys/xDPR4A9At7gxfkYHwF2sPAE59MgAmwgbCZsIMxGQNRWtkN8CK4fEcEGomXn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbAREI8IGonHn2EAsP4lsBEQjwgaicefYQCw/iWwERCPCBqJx59hALD+JbARE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" alt="BKS AB Logo" class="logo" />
        </div>
        
        <h1>Vackra och hÃ¥llbara uteplatser</h1>
        
        <table class="header-table">
          <tr>
            <td>
              <strong>BestÃ¤llare:</strong><br />
              ${clientName}<br />
              ${clientAddress}<br />
              ${clientPhone}<br />
              ${clientEmail}
            </td>
            <td>
              <strong>EntreprenÃ¶r:</strong><br />
              BKS AB<br />
              Kungsgatan 29, 111 56 Stockholm<br />
              Org.nr: 559179-6700<br />
              0735757897<br />
              info@bksakeri.se<br />
              <br />
              FÃ¶retaget innehar F-skattsedel samt allrisk- och ansvarsfÃ¶rsÃ¤kring i Gjensidige FÃ¶rsÃ¤kring
            </td>
          </tr>
        </table>

        <div class="greeting">
          Hej ${estimate.lead?.first_name || 'Kund'},
        </div>

        <p><strong>VÃ¤lkommen till ditt nya stenprojekt med BKS AB!</strong></p>

        <p>I denna offert presenterar vi vÃ¥rt sÃ¤tt fÃ¶r att fÃ¶rverkliga din vision om en vacker och funktionell stenlagd uteplats. Baserat pÃ¥ vÃ¥rt inledande samtal och platsbesÃ¶k har vi skrÃ¤ddarsytt en lÃ¶sning som mÃ¶ter dina specifika Ã¶nskemÃ¥l och behov.</p>

        <p>HÃ¤r beskriver vi ingÃ¥ende vÃ¥r arbetsprocess, frÃ¥n noggrann planering och materialval till grundarbete och hantverksmÃ¤ssig stenlÃ¤ggning. Du fÃ¥r ocksÃ¥ en detaljerad specifikation av valda produkter, en transparent prisbild samt information om garantier.</p>

        <p>VÃ¥rt mÃ¥l Ã¤r att du ska kÃ¤nna dig trygg och vÃ¤linformerad genom hela processen. Vi hoppas att denna offert ger dig en tydlig bild av hur vi pÃ¥ BKS AB kan hjÃ¤lpa dig att skapa uteplatsen du drÃ¶mmer om. Tveka inte att hÃ¶ra av dig med frÃ¥gor!</p>

        <p><strong>LÃ¥t oss tillsammans ta fÃ¶rsta steget mot fÃ¶rverkligandet av ditt stenprojekt!</strong></p>

        <h2>Arbetsprocess - frÃ¥n idÃ© till fÃ¤rdigt resultat</h2>

        <h3>Detaljerad offert baserad pÃ¥ dina Ã¶nskemÃ¥l</h3>
        <p>Baserat pÃ¥ den kostnadsfria konsultationen och platsbesÃ¶ket, dÃ¤r vi lyssnade pÃ¥ dina tankar och Ã¶nskemÃ¥l samt inspekterade ytan, har vÃ¥ra experter tagit fram denna detaljerade offert. HÃ¤r presenterar vi vÃ¥ra rekommendationer kring lÃ¤mpliga material och designlÃ¶sningar, skrÃ¤ddarsydda fÃ¶r ditt projekt. Offerten har ett fastpris, sÃ¥ du slipper Ã¶verraskningar lÃ¤ngre fram.</p>

        <h3>Noggrann planering och materialval</h3>
        <p>NÃ¤r du accepterat offerten gÃ¥r vi vidare med noggrann planering. Vi stÃ¤mmer av dina val av plattor, fÃ¤rg och mÃ¶nster och bestÃ¤ller hem hÃ¶gkvalitativt material frÃ¥n vÃ¤lrenommerade leverantÃ¶rer. Allt fÃ¶r att fÃ¶rverkliga din vision.</p>

        <h3>Grundarbete med fokus pÃ¥ hÃ¥llbarhet</h3>
        <p>PÃ¥ utsatt datum bÃ¶rjar vÃ¥rt team arbetet. Beroende pÃ¥ ytans beskaffenhet och fÃ¶rutsÃ¤ttningar anpassar vi grundarbetet:</p>

        <p><strong>Scenario 1: Ytan Ã¤r fÃ¶rberedd fÃ¶r stenlÃ¤ggning</strong><br />
        Om ytan redan Ã¤r fÃ¶rberedd kontrollerar vi fÃ¶rst att lutningen Ã¤r korrekt fÃ¶r god vattenavrinning. Vid behov justerar vi fallet med hjÃ¤lp av laser och vattenpass. DÃ¤refter lÃ¤gger vi ut ett lager av stenflis eller stenmjÃ¶l som ytskikt, fÃ¶r optimal drÃ¤nering och bÃ¤righet.</p>

        <p><strong>Scenario 2: Ytan krÃ¤ver fullstÃ¤ndig preparation</strong><br />
        Om ytan dÃ¤remot inte Ã¤r fÃ¶rberedd, bÃ¶rjar vi med att grÃ¤va ut till rÃ¤tt djup. Detta gÃ¶rs fÃ¶r hand, med kranbil eller grÃ¤vmaskin, beroende pÃ¥ ytans storlek och Ã¥tkomlighet. Vi lÃ¤gger sedan en fiberduk som separerar underlaget och fÃ¶rhindrar ogrÃ¤s. OvanpÃ¥ detta fyller vi pÃ¥ med bergkross i lÃ¤mplig fraktion som bÃ¤rlager. Varje lager packas noggrant med vibroplatta fÃ¶r att skapa en stabil grund. Slutligen adderar vi ett ytskikt av stenflis, och pÃ¥ sÃ¥ sÃ¤tt fÃ¶rbereder vi fÃ¶r stenlÃ¤ggning.</p>

        <p>Oavsett utgÃ¥ngslÃ¤ge utfÃ¶r vi grundarbetet med omsorg och expertis. Vi anvÃ¤nder alltid Ã¤ndamÃ¥lsenlig utrustning och beprÃ¶vade metoder fÃ¶r att skapa bÃ¤sta mÃ¶jliga fÃ¶rutsÃ¤ttningar fÃ¶r din nya stenlÃ¤ggning. Detta grundarbete Ã¤r avgÃ¶rande fÃ¶r ett hÃ¥llbart och lÃ¥ngvarigt resultat.</p>

        <h3>StenlÃ¤ggning med kÃ¤nsla fÃ¶r detaljer</h3>
        <p>Med en stabil grund pÃ¥ plats Ã¤r det dags fÃ¶r vÃ¥ra hantverkare att lÃ¤gga stenarna enligt det Ã¶verenskomna mÃ¶nstret. Detta gÃ¶rs med stÃ¶rsta precision och kÃ¤nsla fÃ¶r detaljer. Stenar tilldelas och ytterkanterna anpassas genom kapning fÃ¶r ett prydligt intryck. Plattorna sÃ¤tts med distanser fÃ¶r jÃ¤mna fogar som sedan fylls med specialanpassat fogmaterial. Vi anvÃ¤nder moderna hjÃ¤lpmedel men traditionell hantverksskicklighet Ã¤r avgÃ¶rande fÃ¶r ett gediget slutresultat.</p>

        <h3>Avslutande finish och kvalitetskontroll</h3>
        <p>I slutfasen finputsar vi ytan genom att sopa rent och tvÃ¤tta bort eventuella fogrester. VÃ¥rt mÃ¥l Ã¤r att lÃ¤mna Ã¶ver en fin stenlÃ¤ggning som Ã¶vertrÃ¤ffar dina fÃ¶rvÃ¤ntningar. Som ett sista steg gÃ¶r vi en grundlig kvalitetsgenomgÃ¥ng tillsammans med dig som kund, fÃ¶r att sÃ¤kerstÃ¤lla att allt Ã¤r enligt Ã¶nskemÃ¥l.</p>

        <p>Genom hela processen, frÃ¥n offertfÃ¶rfrÃ¥gan till avslutad stenlÃ¤ggning, sÃ¤tter vi dina Ã¶nskemÃ¥l i centrum. Med gedigen erfarenhet, kvalitetsmaterial och beprÃ¶vade metoder ser vi till att leverera resultat som Ã¶vertrÃ¤ffar fÃ¶rvÃ¤ntningarna. LÃ¥t BKS AB fÃ¶rverkliga visionen om din nya uteplats!</p>

        <div class="page-break"></div>

        <h2>Arbetets omfattning med pris</h2>

        <table class="estimate-table">
          <thead>
            <tr>
              <th>Beskrivning</th>
              <th>Kvantitet</th>
              <th>Enhet</th>
              <th>Pris/enhet</th>
              <th class="text-right">Summa</th>
            </tr>
          </thead>
          <tbody>
            ${estimateTableHTML}
            <tr>
              <td colspan="5"></td>
            </tr>
            <tr class="final-totals">
              <td colspan="4"><strong>Summa exkl. moms</strong></td>
              <td class="text-right"><strong>${formatCurrency(estimate.total_amount)}</strong></td>
            </tr>
            <tr class="final-totals">
              <td colspan="4"><strong>Moms (25%)</strong></td>
              <td class="text-right"><strong>${formatCurrency(estimate.vat_amount)}</strong></td>
            </tr>
            <tr class="final-totals">
              <td colspan="4"><strong>Totalt inkl. moms</strong></td>
              <td class="text-right"><strong>${formatCurrency(estimate.total_amount_vat)}</strong></td>
            </tr>
          </tbody>
        </table>

        <p><strong>BerÃ¤knad arbetstid:</strong> ${estimate.estimated_work_days} arbetsdagar</p>
        <p><strong>Offerten gÃ¤ller till:</strong> ${formatDate(estimate.valid_until)}</p>

        <h2>Dokumentation och kommunikation under projektets gÃ¥ng</h2>

        <p>PÃ¥ BKS AB tror vi pÃ¥ vikten av Ã¶ppen kommunikation och transparens genom hela projektet. FrÃ¥n start till mÃ¥l Ã¤r du som kund involverad och informerad. Detta ger dig trygghet och insyn i hur arbetet fortskrider.</p>

        <p><strong>Innan projektstart:</strong></p>
        <ul>
          <li>Detaljerad offert med specifikationer och prisbild</li>
          <li>Tydlig tidplan</li>
          <li>Kontaktinformation till ansvarig projektledare</li>
        </ul>

        <p><strong>Under stenlÃ¤ggningen:</strong></p>
        <ul>
          <li>Regelbundna uppdateringar frÃ¥n projektledaren via telefon eller e-post</li>
          <li>Bilduppdateringar som visar arbetets framsteg, skickade till dig digitalt</li>
        </ul>

        <p><strong>Efter avslutat projekt:</strong></p>
        <ul>
          <li>Slutdokumentation med bilder pÃ¥ den fÃ¤rdiga stenlÃ¤ggningen</li>
          <li>SkÃ¶tselrÃ¥d och instruktioner fÃ¶r att bevara ytan i toppskick</li>
          <li>Garantibevis och information om vÃ¥r eftermarknadsservice</li>
        </ul>

        <p><strong>UtÃ¶ver detta dokumenterar vi Ã¤ven arbetet internt fÃ¶r kvalitetssÃ¤kring:</strong></p>

        <ul>
          <li>Dagliga checklistor fÃ¶r utfÃ¶rt arbete och anvÃ¤nda material</li>
          <li>Egenkontroller enligt branschstandard</li>
          <li>Fotodokumentation av kritiska moment, t.ex. grundarbete och avvattningslÃ¶sningar</li>
        </ul>

        <p>All denna dokumentation arkiveras digitalt och Ã¤r tillgÃ¤nglig fÃ¶r dig som kund Ã¤ven efter avslutat projekt. Du ska kÃ¤nna dig trygg i att arbetet Ã¤r utfÃ¶rt enligt konstens alla regler och att du har full insyn i processen.</p>

        <p>Vi vÃ¤rdesÃ¤tter kommunikation och Ã¤r alltid bara ett telefonsamtal bort om du har frÃ¥gor eller funderingar. Med BKS AB kan du kÃ¤nna dig trygg genom hela resan frÃ¥n idÃ© till fÃ¤rdig stenlÃ¤ggning. Transparens Ã¤r en av hÃ¶rnstenarna i vÃ¥r verksamhet.</p>

        <div class="page-break"></div>

        <h2>Ã–vriga bestÃ¤mmelser</h2>

        <h3>FÃ¶rberedelse:</h3>
        <p>FÃ¶r att sÃ¤kerstÃ¤lla en smidig start pÃ¥ ditt stenlÃ¤ggningsprojekt behÃ¶ver vi att du som kund ser till att arbetsytan Ã¤r fri frÃ¥n hinder. Detta innebÃ¤r att flytta mÃ¶bler, krukor eller andra fÃ¶remÃ¥l som kan stÃ¥ i vÃ¤gen. Vi behÃ¶ver ocksÃ¥ tillgÃ¥ng till el och vatten i nÃ¤rheten av arbetsomrÃ¥det. Om det finns sÃ¤rskilda Ã¶nskemÃ¥l eller fÃ¶rutsÃ¤ttningar att ta hÃ¤nsyn till, ber vi dig att informera oss om detta i god tid fÃ¶re projektstart.</p>

        <h3>Verktyg:</h3>
        <p>FÃ¶r att sÃ¤kerstÃ¤lla effektivitet och precision i vÃ¥rt arbete anvÃ¤nder vi specialanpassade verktyg och maskiner avsedda fÃ¶r stenlÃ¤ggning. Detta inkluderar plattlyft fÃ¶r ergonomisk hantering samt markvibrator och stampar fÃ¶r kompaktering av underlag. VÃ¥ra hantverkare har tillgÃ¥ng till den utrustning som krÃ¤vs fÃ¶r att utfÃ¶ra ett professionellt arbete och Ã¤r vÃ¤l fÃ¶rtrogen med dess anvÃ¤ndning.</p>

        <h3>Avfallshantering:</h3>
        <p>Vi pÃ¥ BKS AB strÃ¤var efter att minimera vÃ¥rt miljÃ¶avtryck och hanterar allt avfall frÃ¥n projektet pÃ¥ ett ansvarsfullt sÃ¤tt. Ã–verblivet material som plattor, bergkross och stenmjÃ¶l Ã¥teranvÃ¤nds i mÃ¥n av mÃ¶jlighet i framtida projekt. Annat avfall som plast, kartong och Ã¶vrigt byggmaterial sorteras och Ã¥tervinns enligt gÃ¤llande miljÃ¶fÃ¶reskrifter. Som kund behÃ¶ver du inte oroa dig fÃ¶r bortforsling av avfall dÃ¥ detta ingÃ¥r i vÃ¥rt Ã¥tagande.</p>

        <h3>ArbetsmiljÃ¶:</h3>
        <p>SÃ¤kerhet och trivsel pÃ¥ arbetsplatsen Ã¤r viktigt fÃ¶r oss. VÃ¥ra hantverkare fÃ¶ljer gÃ¤llande arbetsmiljÃ¶regler och anvÃ¤nder fÃ¶reskriven skyddsutrustning som hjÃ¤lm, skyddsglasÃ¶gon och handskar. Vi tillÃ¤mpar ergonomiska arbetsmetoder fÃ¶r att minimera risken fÃ¶r fÃ¶rslitningsskador. Regelbundna arbetsplatstrÃ¤ffar hÃ¥lls fÃ¶r att diskutera sÃ¤kerhet och komma med fÃ¶rbÃ¤ttringsfÃ¶rslag. Vi tror pÃ¥ en Ã¶ppen dialog och uppmuntrar bÃ¥de personal och kunder att pÃ¥tala eventuella brister.</p>

        <h3>Transporter och lyft:</h3>
        <p>Allt material som krÃ¤vs fÃ¶r ditt stenlÃ¤ggningsprojekt, inklusive plattor, bÃ¤rlager och fogsand, transporteras till arbetsplatsen med fÃ¶retagets egna fordon. VÃ¥ra fordon Ã¤r anpassade fÃ¶r Ã¤ndamÃ¥let och uppfÃ¼ller gÃ¤llande sÃ¤kerhets- och utslÃ¤ppskrav. Vid lossning anvÃ¤nder vi kran eller truck beroende pÃ¥ fÃ¶rutsÃ¤ttningarna pÃ¥ plats. Lyft och fÃ¶rflyttning av tunga material sker med stÃ¶rsta fÃ¶rsiktighet fÃ¶r att undvika skador.</p>

        <h3>FÃ¶rsÃ¤kring:</h3>
        <p>BKS AB har en heltÃ¤ckande ansvarsfÃ¶rsÃ¤kring hos Gjensidige FÃ¶rsÃ¤kring som skyddar bÃ¥de oss och dig som kund vid eventuella skador eller olyckor i samband med vÃ¥rt arbete. FÃ¶rsÃ¤kringen gÃ¤ller fÃ¶r skador pÃ¥ personer, egendom och utfÃ¶rt arbete och ger dig som kund ett extra skydd vid ofÃ¶rutsedda hÃ¤ndelser.</p>

        <h2>Hantering av ofÃ¶rutsedda problem eller hinder</h2>

        <p>Trots noggrann planering kan ofÃ¶rutsedda situationer uppstÃ¥ under arbetets gÃ¥ng, t.ex:</p>
        <ul>
          <li>UpptÃ¤ckt av sÃ¤ttningsskador eller andra problem med underlaget</li>
          <li>Extrema vÃ¤derfÃ¶rhÃ¥llanden som fÃ¶rsenas eller hindrar arbetet</li>
          <li>FÃ¶rseningar i materialleveranser frÃ¥n tredje part</li>
        </ul>

        <p>Om sÃ¥dana omstÃ¤ndigheter intrÃ¤ffar kommer vi omgÃ¥ende att kommunicera detta till dig som kund. Tillsammans finner vi den bÃ¤sta lÃ¶sningen fÃ¶r att komma vidare i projektet pÃ¥ ett smidigt sÃ¤tt. Eventuella merkostnader till fÃ¶ljd av ofÃ¶rutsedda hinder hanteras som tillÃ¤ggsarbete efter godkÃ¤nnande frÃ¥n dig.</p>

        <h2>Ã„ndringar och tillÃ¤ggsarbeten</h2>

        <p>Vi strÃ¤var alltid efter att uppfylla dina Ã¶nskemÃ¥l och Ã¤r flexibla fÃ¶r Ã¤ndringar under projektets gÃ¥ng. Om du kommer pÃ¥ nya idÃ©er eller vill gÃ¶ra tillÃ¤gg utÃ¶ver grundofferten har vi rutiner fÃ¶r att hantera detta:</p>
        <ul>
          <li>Meddela Ã¶nskemÃ¥len till ansvarig projektledare.</li>
          <li>Vi tar fram en specifikation och prissÃ¤ttning fÃ¶r tillÃ¤ggsarbetet.</li>
          <li>Efter ditt godkÃ¤nnande planerar vi in arbetet pÃ¥ lÃ¤mpligaste sÃ¤tt.</li>
          <li>TillÃ¤ggsarbetet faktureras separat efter utfÃ¶rande.</li>
        </ul>

        <p>Genom att ha en tydlig och transparent hantering av vad som ingÃ¥r och inte ingÃ¥r i offerten, samt hur vi hanterar avvikelser, skapar vi trygghet fÃ¶r dig som kund. Du ska veta vad du kan fÃ¶rvÃ¤nta dig och inte behÃ¶va oroa dig fÃ¶r dolda kostnader.</p>

        <h2>Referenser</h2>

        <p>VÃ¥ra tidigare kunder Ã¤r de bÃ¤sta ambassadÃ¶rerna fÃ¶r vÃ¥rt arbete. De har upplevt vÃ¥r stenlÃ¤ggningsprocess frÃ¥n start till mÃ¥l och kan ge dig en Ã¤rlig inblick i hur det Ã¤r att samarbeta med oss. Genom att hÃ¶ra deras berÃ¤ttelser fÃ¥r du en god uppfattning om vÃ¥r kompetens, service och kvalitet.</p>

        <p>Tveka inte att kontakta nÃ¥gra av vÃ¥ra tidigare kunder fÃ¶r att hÃ¶ra deras omdÃ¶men. De kan ge dig vÃ¤rdefulla insikter och svar pÃ¥ frÃ¥gor du kanske har infÃ¶r ditt eget stenprojekt. Att hÃ¶ra nÃ¥gon annans positiva upplevelse kan ge extra trygghet nÃ¤r du fattar ditt beslut.</p>

        <p>Nedan finner du kontaktuppgifter till ett urval av vÃ¥ra tidigare kunder. KÃ¤nn dig fri att kontakta dem!</p>

        <ol>
          <li><strong>Abbe</strong> - Bygg och MiljÃ¶ - 0737280744</li>
          <li><strong>Rajaa</strong> - SÃ¶derby - 0737768162</li>
          <li><strong>Hadil</strong> - Uppsala - 0760062967</li>
          <li><strong>Maria</strong> - Farsta - 0737868856</li>
          <li><strong>Razvan</strong> - Asielbygg - 07320550031</li>
        </ol>

        <h2>Betalning</h2>

        <p><strong>Fakturering:</strong><br />
        Vi tillÃ¤mpar fÃ¶ljande faktureringsprocess fÃ¶r att gÃ¶ra det smidigt fÃ¶r dig som kund:</p>
        <ul>
          <li>30% av totalsumman faktureras vid projektstart och betalas innan arbetet pÃ¥bÃ¶rjas.</li>
          <li>30% faktureras nÃ¤r grundarbetet Ã¤r slutfÃ¶rt och betalas inom 10 dagar.</li>
          <li>Resterande 40% faktureras vid godkÃ¤nd slutbesiktning och betalas inom 10 dagar.</li>
        </ul>

        <p>Eventuella tillÃ¤ggsarbeten faktureras separat efter utfÃ¶rande med 10 dagars betalningstid.</p>

        <h3>Betalningsvillkor:</h3>
        <ul>
          <li>Fakturor betalas inom 10 dagar frÃ¥n fakturadatum.</li>
          <li>Vid fÃ¶rsenad betalning utgÃ¥r drÃ¶jsmÃ¥lsrÃ¤nta enligt gÃ¤llande referensrÃ¤nta + 8%.</li>
          <li>BKS AB fÃ¶rbehÃ¥ller sig Ã¤ganderÃ¤tten av allt material tills full betalning erlagts.</li>
        </ul>

        <h2>Garanti</h2>

        <p><strong>Garantitid:</strong></p>
        <ul>
          <li>PÃ¥ utfÃ¶rt arbete lÃ¤mnar vi 2 Ã¥rs garanti.</li>
          <li>PÃ¥ material gÃ¤ller respektive tillverkares garantier, generellt 2-5 Ã¥r.</li>
        </ul>

        <p><strong>Garantivillkor:</strong></p>
        <ul>
          <li>Garantin omfattar arbetsutfÃ¶rande och materialkvalitet enligt branschstandard.</li>
          <li>Undantag frÃ¥n garantin Ã¤r skador orsakade av yttre pÃ¥verkan, bristande underhÃ¥ll, onormalt slitage eller Ã¤ndringar utfÃ¶rda av tredje part.</li>
          <li>FÃ¶r att garantin ska gÃ¤lla skall skÃ¶tselinstruktioner fÃ¶ljas.</li>
        </ul>

        <h2>FÃ¶rsÃ¤kring</h2>

        <p>BKS AB har en ansvarsfÃ¶rsÃ¤kring hos Gjensidige FÃ¶rsÃ¤kring som tÃ¤cker eventuella skador orsakade av vÃ¥rt arbete upp till 10 Mkr. Vi Ã¤r ocksÃ¥ fullt fÃ¶rsÃ¤krade om olyckor och skador pÃ¥ vÃ¥r egen personal och utrustning. Du Ã¤r trygg med oss!</p>

        <h2>Vi friskriver oss frÃ¥n</h2>

        <p><strong>Berg som kan fÃ¶rekomma vid grÃ¤vning:</strong> GÃ¥r det inte att grÃ¤va ner till den nivÃ¥ som vi behÃ¶ver pÃ¥ grund av att vi hittar berg sÃ¥ blir det en extra kostnad fÃ¶r det jobbet.</p>

        <p><strong>Ledningar:</strong> Du som kund Ã¤r ansvarig fÃ¶r att visa var ledningar som Ã¤r nedgrÃ¤vda finns. GrÃ¤ver vi bort nÃ¥got som inte har visats fÃ¶r oss kommer vi inte kunna Ã¥terstÃ¤lla det utan kostnad.</p>

        <p><strong>FÃ¶roreningar i mark:</strong> Skulle det vara sÃ¥ att tippen gÃ¶r ett stickprov pÃ¥ schaktmassorna och visar det att det Ã¤r fÃ¶rorenat kommer vi att debitera extra fÃ¶r det.</p>

        <h2>NÃ¤sta steg</h2>

        <p>FÃ¶r att boka tjÃ¤nsten och komma igÃ¥ng med ditt stenprojekt gÃ¶r du sÃ¥ hÃ¤r:</p>
        <ul>
          <li>Acceptera offerten genom att svara pÃ¥ e-post eller ringa oss direkt.</li>
          <li>VÃ¤lj Ã¶nskat startdatum fÃ¶r projektet i samrÃ¥d med vÃ¥r projektledare.</li>
          <li>Projektering och materialleverans planeras in utifrÃ¥n Ã¶nskat startdatum.</li>
          <li>Underteckna och returnera HantverkarformulÃ¤ret som vÃ¥rt kontrakt innan projektstart.</li>
          <li>Vi ses pÃ¥ plats fÃ¶r uppstartsgenomgÃ¥ng pÃ¥ utsatt datum!</li>
        </ul>

        <p>Denna offert Ã¤r giltig i 30 dagar frÃ¥n dagens datum. Tveka inte att hÃ¶ra av dig om du har nÃ¥gra frÃ¥gor!</p>

        <div class="contact-info">
          <p><strong>Kontaktperson:</strong><br />
          Ramiro Botero, projektledare<br />
          Tel: 073 575 78 97<br />
          E-post: info@bksakeri.se<br />
          https://www.bksakeri.se</p>

          <div class="signature-section">
            <p>Vi ser fram emot att fÃ¶rverkliga ditt stenprojekt!</p>
            <p><strong>Med vÃ¤nliga hÃ¤lsningar,<br />
            Teamet pÃ¥ BKS AB</strong></p>
          </div>
        </div>
      </body>
    </html>
  `;
}

/**
 * Generate PDF from estimate data using Puppeteer
 */
export async function generateEstimatePDF(estimate: EstimateData): Promise<Buffer> {
  let browser;
  
  try {
    // Configure for Vercel serverless environment
    const isProduction = process.env.NODE_ENV === 'production';
    console.log('PDF Generation environment:', { isProduction, nodeEnv: process.env.NODE_ENV });
    
    if (isProduction) {
      // Use @sparticuz/chromium for Vercel deployment
      console.log('Using @sparticuz/chromium for production');
      browser = await puppeteer.launch({
        args: [
          ...chromium.args,
          '--hide-scrollbars',
          '--disable-web-security',
          '--disable-features=VizDisplayCompositor',
        ],
        executablePath: await chromium.executablePath(),
        headless: true,
      });
    } else {
      // Local development
      browser = await puppeteer.launch({
        headless: true,
        args: [
          '--no-sandbox',
          '--disable-setuid-sandbox',
          '--disable-dev-shm-usage',
          '--disable-accelerated-2d-canvas',
          '--no-first-run',
          '--no-zygote',
          '--disable-gpu'
        ]
      });
    }

    const page = await browser.newPage();

    // Generate HTML content
    const htmlContent = generateHTMLContent(estimate);

    // Set page content
    await page.setContent(htmlContent, {
      waitUntil: 'networkidle0'
    });

    // Generate PDF with options
    const pdfBuffer = await page.pdf({
      format: 'A4',
      printBackground: true,
      margin: {
        top: '20mm',
        right: '15mm',
        bottom: '20mm',
        left: '15mm'
      },
      displayHeaderFooter: true,
      headerTemplate: `
        <div style="font-size: 10px; text-align: center; width: 100%; color: #666;">
          <span>BKS AB - Offert #${estimate.estimate_nr}</span>
        </div>
      `,
      footerTemplate: `
        <div style="font-size: 10px; text-align: center; width: 100%; color: #666;">
          <span>Sida <span class="pageNumber"></span> av <span class="totalPages"></span></span>
        </div>
      `,
      preferCSSPageSize: false
    });

    return Buffer.from(pdfBuffer);

  } catch (error) {
    console.error('Error generating PDF:', error);
    throw new Error('Failed to generate PDF');
  } finally {
    if (browser) {
      await browser.close();
    }
  }
}

/**
 * Generate filename for the PDF
 */
export function generatePDFFilename(estimate: EstimateData): string {
  const clientName = estimate.lead 
    ? `${estimate.lead.first_name}_${estimate.lead.last_name}`.replace(/\s+/g, '_')
    : 'kund';
  
  const date = new Date().toISOString().split('T')[0];
  
  return `BKS_Offert_${estimate.estimate_nr}_${clientName}_${date}.pdf`;
}